version: "3.9"

services:
    frontend:
        build:
            context: ./frontend
            dockerfile: Dockerfile.dev
        ports:
            - "5173:5173"
        environment:
            - VITE_API_BASE=http://backend:8000
        depends_on:
            - backend
        develop:
            watch:
                - action: sync
                  path: ./frontend/src
                  target: /app/src
                - action: rebuild
                  path: ./frontend/package.json
                - action: rebuild
                  path: ./frontend/package-lock.json

    backend:
        build:
            context: ./backend
            dockerfile: Dockerfile.dev
        ports:
            - "8000:8000"
        env_file:
            - ./backend/.env
        depends_on:
            - db
        develop:
            watch:
                - action: sync
                  path: ./backend/app
                  target: /app/app
                - action: rebuild
                  path: ./backend/requirements.txt

    db:
        image: postgres:16
        environment:
            POSTGRES_DB: appdb
            POSTGRES_USER: appuser
            POSTGRES_PASSWORD: appsecret
        ports:
            - "5432:5432"
        volumes:
            - pgdata:/var/lib/postgresql/data

volumes:
    pgdata:
